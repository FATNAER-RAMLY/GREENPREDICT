<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenPredict üåø</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background"></div>
    <div class="container">
        <h1>GreenPredictüåø</h1>
        <p class="subheader">T√©l√©chargez une image de feuille pour d√©tecter les maladies des plantes.</p>

        <!-- Zone de t√©l√©chargement d'image -->
        <div class="upload-section">
            <form action="/" method="post" enctype="multipart/form-data">
                <label for="file" class="upload-label">
                    <span class="upload-icon">üìÅ</span>
                    <span class="upload-text">Choisir une image</span>
                </label>
                <input type="file" name="file" id="file" accept=".jpg, .jpeg, .png" required>
                <button type="submit" class="upload-button">Analyser l'image</button>
            </form>
        </div>

        <!-- Aper√ßu de l'image t√©l√©charg√©e -->
        <div class="image-preview" id="image-preview" style="display: none;">
            <h2>Aper√ßu de l'Image</h2>
            <div class="image-container">
                <img id="preview" src="#" alt="Aper√ßu de l'image" class="uploaded-image">
            </div>
        </div>

        <!-- R√©sultats de la pr√©diction -->
        {% if results %}
        <div class="result-section">
            <h2>R√©sultats de la Pr√©diction</h2>

            <!-- Afficher la maladie pr√©dite -->
            <div class="prediction-card">
                <p><strong>La maladie pr√©dite est :</strong> <span class="predicted-class">{{ results.predicted_class }}</span></p>
            </div>

            <!-- Afficher les probabilit√©s par classe -->
            <h3>Probabilit√©s par classe :</h3>
            <div class="prob-table">
                <table>
                    <thead>
                        <tr>
                            <th>Classe</th>
                            <th>Probabilit√©</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for class_name, prob in results.probabilities.items() %}
                        <tr>
                            <td>{{ class_name }}</td>
                            <td>{{ "%.2f"|format(prob * 100) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Graphique des probabilit√©s -->
            <div class="chart-container">
                <canvas id="probChart"></canvas>
            </div>
        </div>
        {% endif %}

        <!-- Pied de page -->
        <footer class="footer">
            D√©velopp√© avec ‚ù§Ô∏è par FATNA ER-RAMLY, HAJAR EL MZALNI et NAOUAL KHLOUFI
        </footer>
    </div>

    <!-- Chart.js pour le graphique -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Donn√©es pour le graphique
        {% if results %}
        const labels = {{ results.probabilities.keys() | list | tojson | safe }};
        const data = {{ results.probabilities.values() | list | tojson | safe }};

        // Configuration du graphique
        const ctx = document.getElementById('probChart').getContext('2d');
        const probChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Probabilit√©s',
                    data: data,
                    backgroundColor: 'rgba(46, 134, 193, 0.6)',
                    borderColor: 'rgba(46, 134, 193, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1
                    }
                }
            }
        });
        {% endif %}

        // JavaScript pour l'aper√ßu de l'image
        document.getElementById('file').addEventListener('change', function(event) {
            const file = event.target.files[0];  // R√©cup√©rer le fichier s√©lectionn√©
            const preview = document.getElementById('preview');  // R√©cup√©rer l'√©l√©ment img pour l'aper√ßu
            const imagePreview = document.getElementById('image-preview');  // R√©cup√©rer le conteneur de l'aper√ßu

            if (file) {
                const reader = new FileReader();  // Cr√©er un FileReader pour lire le fichier

                // Lorsque le fichier est lu, afficher l'aper√ßu
                reader.onload = function(e) {
                    preview.src = e.target.result;  // D√©finir la source de l'image
                    imagePreview.style.display = 'block';  // Afficher le conteneur de l'aper√ßu
                };

                reader.readAsDataURL(file);  // Lire le fichier comme une URL de donn√©es
            } else {
                preview.src = '#';  // R√©initialiser l'aper√ßu si aucun fichier n'est s√©lectionn√©
                imagePreview.style.display = 'none';  // Masquer le conteneur de l'aper√ßu
            }
        });
    </script>
</body>
</html>